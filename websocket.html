<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <label for="token">Token:</label>
    <input type="text" id="token" placeholder="Enter your token">
    <br>
    <label for="topic">Topic:</label>
    <input type="text" id="topic" placeholder="Enter your topic">
    <br>
    <button onclick="connectWebSocket()">Connect WebSocket</button>
    <button onclick="sendMessage()">Send Message</button>
    <div id="messages"></div>

    <script>
        let socket;

        function connectWebSocket() {
            const token = document.getElementById("token").value;
            const topic = document.getElementById("topic").value;
            const url = `ws://localhost:8000/ws/${topic}?token=${token}`;

            socket = new WebSocket(url);

            socket.onopen = function(event) {
                console.log("WebSocket is open now.");
                document.getElementById("messages").innerHTML += "<p>WebSocket is open now.</p>";
            };

            socket.onmessage = function(event) {
                console.log("WebSocket message received:", event.data);
                document.getElementById("messages").innerHTML += `<p>Message received: ${event.data}</p>`;
            };

            socket.onclose = function(event) {
                console.log("WebSocket is closed now.");
                document.getElementById("messages").innerHTML += "<p>WebSocket is closed now.</p>";
            };

            socket.onerror = function(error) {
                console.log("WebSocket error:", error);
                document.getElementById("messages").innerHTML += `<p>WebSocket error: ${error.message}</p>`;
            };
        }

        function sendMessage() {
            if (socket && socket.readyState === WebSocket.OPEN) {
                const message = {
                    message: "Hello, LLM!"
                };
                socket.send(JSON.stringify(message));
                console.log("Message sent:", message);
                document.getElementById("messages").innerHTML += `<p>Message sent: ${JSON.stringify(message)}</p>`;
            } else {
                console.log("WebSocket is not open.");
                document.getElementById("messages").innerHTML += "<p>WebSocket is not open.</p>";
            }
        }
    </script>
</body>
</html>